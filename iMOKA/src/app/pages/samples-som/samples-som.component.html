<div class="row" #mainPage>
  <mat-card class="sticky-options col-md-12" > <mat-card-content [class.no-padding]="hideOptions">
  <div [class.hidden-vertical]="hideOptions" class="hidden-vertical-fade">
    <h4 style="margin: 0;">Options and filters</h4>
    <div class="row">
      <mat-form-field class="col-md-3"> <mat-label>Number of samples clusters</mat-label> <mat-select [(ngModel)]="clust" value="{{clust}}" (openedChange)="! $event && update()"> <mat-option *ngFor="let clustopt of clust_select; index as i" value="{{clustopt.id}}">{{clustopt.nclust}}</mat-option> </mat-select> </mat-form-field>
      <mat-form-field class="col-md-3"> <mat-label>View style</mat-label> <mat-select [(ngModel)]="normOption" value="{{normOption}}" (openedChange)="! $event && update()"> <mat-option value="normByNode">normalize by node</mat-option> <mat-option value="centerAvrg">center on average samples</mat-option> <mat-option value="raw">raw count</mat-option> </mat-select> </mat-form-field>
    </div>
    <div class="row">
      <mat-form-field class="col-md-3"> <mat-label>Cluster filter</mat-label> <mat-select [(ngModel)]="clustFilterl" (openedChange)="! $event && update()" multiple> <mat-option *ngFor="let clu of hexamappes.indices;let i = index" [value]="i">Cluster {{i}}</mat-option> </mat-select> </mat-form-field>
      <mat-form-field class="col-md-3"> <mat-label>Categories filter</mat-label> <mat-select [(ngModel)]="catFilterl" (openedChange)="! $event && update()" multiple> <mat-option *ngFor="let catl of catergoryList" [value]="catl">{{catl}}</mat-option> </mat-select> </mat-form-field>
      <mat-form-field class="col-md-3"> <mat-label>Samples name filter</mat-label> <mat-select [(ngModel)]="sampleFilterl" (openedChange)="! $event && update()" multiple> <mat-option *ngFor="let sample of this.data.samplesSOM" [value]="sample.labelsamples">{{sample.labelsamples}}</mat-option> </mat-select> </mat-form-field>
    </div>
    <div *ngIf="selectedNodes.length > 0" class="row">
      <div class="col-md-3">
        <div class="button-list-h">
          <button mat-raised-button title="ontology on selected node ( to select multiple nodes keep 'Ctrl' key press)" (click)="updateSelNodesgetonto()">View ontology</button>
          <button mat-raised-button *ngIf="selectedNodes.length > 0" title="Distribution cumulated on selected node( to select multiple nodes keep 'Ctrl' key press)" (click)="updateSelNodesgetDistrib()">View distribution</button>
        </div>
      </div>
      <div class="col-md-6">
        <mat-chip-list selectable="false"> <mat-chip>Nodes selected:</mat-chip> <mat-chip color="primary" *ngFor="let node of selectedNodes">{{node}}</mat-chip> </mat-chip-list>
      </div>
    </div>
  </div>
  <div class="button-hide-container">
    <button color="primary" mat-mini-fab (click)="hideOptions=!hideOptions">
      <mat-icon *ngIf="hideOptions">expand_more</mat-icon>
      <mat-icon *ngIf="!hideOptions">expand_less</mat-icon>
    </button>
  </div>
  </mat-card-content> </mat-card>
  <div class="col-md-12">
    <mat-tab-group [(selectedIndex)]="somTabIndex" (selectedTabChange)="tabChange($event)" mat-align-tabs="center"> <mat-tab label="Self organizing maps"> <ng-template matTabContent>
      <div class="row">
        <div class="col-md-6 p-2">
          <div class="col-md-12 p-2">
            <mat-card> <mat-card-content>
            <div class="row">
              <div class="col-md-12">
                <h3>General</h3>
              </div>
              <div class="col-md-6" *ngFor="let opt of this.hexamappes.importances">
                <hexamap-app [options]="opt" class="mapcontainer"></hexamap-app>
              </div>
            </div>
            </mat-card-content> </mat-card>
          </div>
          <div class="col-md-12 p-2">
            <mat-card> <mat-card-content>
            <div class="row">
              <div class="col-md-12">
                <h3>Averages</h3>
              </div>
              <div class="col-md-6" *ngFor="let opt of this.hexamappes.averages">
                <hexamap-app [options]="opt" class="mapcontainer"></hexamap-app>
              </div>
            </div>
            </mat-card-content> </mat-card>
          </div>
        </div>
        <div class="col-md-6 p-2">
          <div *ngFor="let grp of hexamappes.indices; index as i" class="col-md-12 p-2">
            <mat-card> <mat-card-content>
            <div class="row">
              <div class="col-md-12">
                <h3>Cluster {{i}}: {{grp.length}} samples</h3>
              </div>
              <div class="col-md-12">
                <div [class.hidden-vertical]="indices[i].hidden" class="hidden-vertical-fade">
                  <div class="row">
                    <div class="col-2">
                      <button [disabled]="indices[i].from_pos < indices[i].to_display" mat-icon-button (click)="indices[i].from_pos=indices[i].from_pos-indices[i].to_display">
                        <mat-icon>skip_previous</mat-icon>
                      </button>
                    </div>
                    <div style="overflow: visible" class="col-6">
                      <mat-slider style="width:90%;margin-top:18px" thumbLabel step="1" [(ngModel)]="indices[i].from_pos" min="0" [max]="grp.length-indices[i].to_display"></mat-slider>
                    </div>
                    <div class="col-2">
                      <button [disabled]="indices[i].from_pos+indices[i].to_display > grp.length" mat-icon-button (click)="indices[i].from_pos=indices[i].from_pos+indices[i].to_display">
                        <mat-icon>skip_next</mat-icon>
                      </button>
                    </div>
                    <mat-form-field class="col-2"> <mat-label>Display</mat-label> <input matInput [(ngModel)]="indices[i].to_display" type='number' min="1" max="100"></mat-form-field>
                  </div>
                  <div class="row">
                    <ng-container *ngFor="let opt of grp; index as j">
                    <div class="col-md-6">
                      <hexamap-app *ngIf="j >= indices[i].from_pos && j < indices[i].from_pos+indices[i].to_display " [options]="opt" class="mapcontainer"></hexamap-app>
                    </div>
                    </ng-container>
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <div class="button-hide-container">
                  <button color="primary" mat-mini-fab (click)="indices[i].hidden=!indices[i].hidden">
                    <mat-icon *ngIf="indices[i].hidden">expand_more</mat-icon>
                    <mat-icon *ngIf="!indices[i].hidden">expand_less</mat-icon>
                  </button>
                </div>
              </div>
            </div>
            </mat-card-content> </mat-card>
          </div>
        </div>
      </div>
    </ng-template> </mat-tab> <mat-tab label="Samples clustering"> <ng-template matTabContent> <mat-card class="tab-content"> <mat-card-content> <plotly-plot [data]="this.data.clusterdist.data" [layout]="this.data.clusterdist.layout" (plotly_click)="barclustdistClick($event)"></plotly-plot> </mat-card-content> </mat-card> </ng-template> </mat-tab> <mat-tab label="Features per node"> <ng-template matTabContent> <mat-card class="tab-content"> <mat-card-title>
    <h3>Features per node</h3>
    </mat-card-title> <mat-card-content *ngIf="this.hexamappes.importances[1]">
    <div class="row">
      <div class="col-md-6">
        <hexamap-app [width]="280" [height]="250" [options]="this.hexamappes.importances[1]" class="mapcontainer"></hexamap-app>
      </div>
      <div class="col-md-6">
          <mat-form-field  class="col-md-12"> <mat-label>Filter</mat-label> <input matInput (keyup)="applyFilter($event)" placeholder="ex: ACCGTGGGA"> </mat-form-field>
        <div class="col-md-12">
          <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
        </div>
        <div class="mat-elevation-z8 col-md-12" >
          <table mat-table [dataSource]="featureSource" matSort>
            <!-- Position Column -->
            <ng-container matColumnDef="bmu">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Map node</th>
            <td mat-cell *matCellDef="let element">{{element.bmu}}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
            <td mat-cell *matCellDef="let element">{{element.name}}</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['bmu','name']; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: ['bmu','name'];"></tr>

          </table>
        </div>
      </div>
    </div>
    </mat-card-content> </mat-card> </ng-template> </mat-tab> <mat-tab label="Other graphs"> <ng-template matTabContent> <mat-card class="tab-content"> <mat-card-content>
    <div class="row">
    <div class="col-md-6">

      <plotly-plot [data]="this.data.graphImportance.data" [layout]="this.data.graphImportance.layout"></plotly-plot>
    </div>
    <div class="col-md-6">
      <plotly-plot [data]="this.data.graphFeatureNumber.data" [layout]="this.data.graphFeatureNumber.layout"></plotly-plot>
    </div>
    </div>
    </mat-card-content> </mat-card> </ng-template> </mat-tab> </mat-tab-group>
  </div>
</div>



